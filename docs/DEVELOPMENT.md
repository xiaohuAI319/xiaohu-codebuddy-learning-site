# å°è™CodeBuddyå­¦ä¹ ç«™ - å¼€å‘æ–‡æ¡£

## ğŸ“‹ ç›®å½•
- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [å¼€å‘ç¯å¢ƒæ­å»º](#å¼€å‘ç¯å¢ƒæ­å»º)
- [é¡¹ç›®ç»“æ„è¯¦è§£](#é¡¹ç›®ç»“æ„è¯¦è§£)
- [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
- [APIæ¥å£æ–‡æ¡£](#apiæ¥å£æ–‡æ¡£)
- [å‰ç«¯ç»„ä»¶è¯´æ˜](#å‰ç«¯ç»„ä»¶è¯´æ˜)
- [ä¼šå‘˜ä½“ç³»è®¾è®¡](#ä¼šå‘˜ä½“ç³»è®¾è®¡)
- [æƒé™æ§åˆ¶æœºåˆ¶](#æƒé™æ§åˆ¶æœºåˆ¶)
- [å¼€å‘è§„èŒƒ](#å¼€å‘è§„èŒƒ)
- [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

## é¡¹ç›®æ¦‚è¿°

å°è™CodeBuddyå­¦ä¹ ç«™æ˜¯ä¸€ä¸ªä¸“ä¸ºAIç¼–ç¨‹å­¦ä¹ è€…æ‰“é€ çš„ä½œå“å±•ç¤ºå¹³å°ï¼Œæ”¯æŒå¤šå±‚ä¼šå‘˜ä½“ç³»ã€æ™ºèƒ½æƒé™æ§åˆ¶ã€ä½œå“ä¸Šä¼ æŠ•ç¥¨ç­‰åŠŸèƒ½ã€‚

### æ ¸å¿ƒç‰¹æ€§
- **å¤šå±‚ä¼šå‘˜ä½“ç³»**: 5å±‚å¯é…ç½®ä¼šå‘˜ç­‰çº§ï¼Œæ”¯æŒåŠ¨æ€æƒé™æ§åˆ¶
- **æ™ºèƒ½å†…å®¹è¿‡æ»¤**: æ ¹æ®ç”¨æˆ·ç­‰çº§è‡ªåŠ¨è¿‡æ»¤å¯è®¿é—®å†…å®¹
- **ä½œå“ç®¡ç†ç³»ç»Ÿ**: æ”¯æŒHTMLæ–‡ä»¶ä¸Šä¼ ã€é“¾æ¥åˆ†äº«ã€å°é¢å±•ç¤º
- **æŠ•ç¥¨æ’åºæœºåˆ¶**: å¤šç»´åº¦æ’åºï¼ˆæŠ•ç¥¨æ•°ã€æµè§ˆé‡ã€å‘å¸ƒæ—¶é—´ï¼‰
- **è®­ç»ƒè¥åˆ†ç±»**: æ”¯æŒå¤šä¸ªè®­ç»ƒè¥çš„ç‹¬ç«‹ç®¡ç†
- **æ”¯ä»˜ä½“ç³»**: ä¼˜æƒ åˆ¸æŠ˜æ‰£å’Œåºåˆ—å·ç›´è´­ç³»ç»Ÿ
- **ç®¡ç†åå°**: å®Œæ•´çš„ç”¨æˆ·ã€ä½œå“ã€ä¼šå‘˜ç®¡ç†ç•Œé¢

## æŠ€æœ¯æ¶æ„

### å‰ç«¯æŠ€æœ¯æ ˆ
```
React 18 + TypeScript + Tailwind CSS
â”œâ”€â”€ React Router Dom 6.x    # è·¯ç”±ç®¡ç†
â”œâ”€â”€ Axios                   # HTTPå®¢æˆ·ç«¯
â”œâ”€â”€ Heroicons              # å›¾æ ‡åº“
â””â”€â”€ å“åº”å¼è®¾è®¡              # ç§»åŠ¨ç«¯é€‚é…
```

### åç«¯æŠ€æœ¯æ ˆ
```
Node.js + Express.js + TypeScript
â”œâ”€â”€ MongoDB + Mongoose      # æ•°æ®åº“ORM
â”œâ”€â”€ JWT                    # èº«ä»½è®¤è¯
â”œâ”€â”€ Multer                 # æ–‡ä»¶ä¸Šä¼ 
â”œâ”€â”€ Bcrypt                 # å¯†ç åŠ å¯†
â”œâ”€â”€ Joi                    # æ•°æ®éªŒè¯
â””â”€â”€ CORS                   # è·¨åŸŸå¤„ç†
```

### æ•°æ®åº“è®¾è®¡
```
MongoDB Collections:
â”œâ”€â”€ users              # ç”¨æˆ·ä¿¡æ¯
â”œâ”€â”€ works              # ä½œå“æ•°æ®
â”œâ”€â”€ membershiptiers    # ä¼šå‘˜ç­‰çº§
â”œâ”€â”€ payments           # æ”¯ä»˜è®°å½•
â”œâ”€â”€ coupons            # ä¼˜æƒ åˆ¸
â”œâ”€â”€ serialcodes        # åºåˆ—å·
â”œâ”€â”€ votes              # æŠ•ç¥¨è®°å½•
â””â”€â”€ bootcamps          # è®­ç»ƒè¥
```

## å¼€å‘ç¯å¢ƒæ­å»º

### ç¯å¢ƒè¦æ±‚
- Node.js >= 16.0.0
- MongoDB >= 4.4.0
- npm >= 8.0.0
- Git >= 2.0.0

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**
```bash
git clone https://github.com/xiaohuAI319/xiaohu-codebuddy-learning-site.git
cd xiaohu-codebuddy-learning-site
```

2. **å®‰è£…ä¾èµ–**
```bash
# æ ¹ç›®å½•å®‰è£…
npm install

# å‰ç«¯ä¾èµ–
cd frontend && npm install

# åç«¯ä¾èµ–
cd ../backend && npm install
```

3. **ç¯å¢ƒé…ç½®**
```bash
# å¤åˆ¶ç¯å¢ƒé…ç½®æ–‡ä»¶
cd backend
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š
```env
# æ•°æ®åº“é…ç½®
MONGODB_URI=mongodb://localhost:27017/xiaohu-codebuddy

# JWTå¯†é’¥ (è¯·æ›´æ¢ä¸ºæ‚¨è‡ªå·±çš„å¯†é’¥)
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production

# æœåŠ¡ç«¯å£
PORT=5000

# å‰ç«¯åœ°å€
FRONTEND_URL=http://localhost:3000

# ç¯å¢ƒ
NODE_ENV=development

# æ–‡ä»¶ä¸Šä¼ é…ç½®
UPLOAD_PATH=./uploads
MAX_FILE_SIZE=10485760  # 10MB

# ç®¡ç†å‘˜é»˜è®¤è´¦å·
ADMIN_EMAIL=admin@xiaohu.com
ADMIN_PASSWORD=admin123456
```

4. **å¯åŠ¨MongoDB**
```bash
# Windows
net start MongoDB

# macOS (ä½¿ç”¨Homebrew)
brew services start mongodb-community

# Linux
sudo systemctl start mongod
```

5. **åˆå§‹åŒ–æ•°æ®åº“**
```bash
cd backend
npm run init-db
```

6. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ŒåŒæ—¶å¯åŠ¨å‰åç«¯
npm run dev

# æˆ–åˆ†åˆ«å¯åŠ¨
npm run dev:frontend  # å‰ç«¯ http://localhost:3000
npm run dev:backend   # åç«¯ http://localhost:5000
```

## é¡¹ç›®ç»“æ„è¯¦è§£

```
xiaohu-codebuddy-learning-site/
â”œâ”€â”€ frontend/                    # å‰ç«¯Reactåº”ç”¨
â”‚   â”œâ”€â”€ public/                 # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ index.html         # HTMLæ¨¡æ¿
â”‚   â”‚   â””â”€â”€ favicon.ico        # ç½‘ç«™å›¾æ ‡
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/        # å¯å¤ç”¨ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Layout.tsx     # é¡µé¢å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx    # ä¾§è¾¹æ ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ WorkCard.tsx   # ä½œå“å¡ç‰‡ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ MembershipBadge.tsx  # ä¼šå‘˜ç­‰çº§æ ‡è¯†
â”‚   â”‚   â”‚   â”œâ”€â”€ UpgradePrompt.tsx    # å‡çº§æç¤ºç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ ProtectedRoute.tsx   # è·¯ç”±ä¿æŠ¤ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ pages/             # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ HomePage.tsx   # é¦–é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ WorksPage.tsx  # ä½œå“å±•ç¤ºé¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ UploadPage.tsx # ä½œå“ä¸Šä¼ é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ LoginPage.tsx  # ç™»å½•é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ RegisterPage.tsx # æ³¨å†Œé¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ MembershipPage.tsx # ä¼šå‘˜ä¸­å¿ƒ
â”‚   â”‚   â”‚   â”œâ”€â”€ AdminPage.tsx  # ç®¡ç†åå°
â”‚   â”‚   â”‚   â””â”€â”€ AdminMembershipPage.tsx # ä¼šå‘˜ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ contexts/          # React Context
â”‚   â”‚   â”‚   â””â”€â”€ AuthContext.tsx # è®¤è¯ä¸Šä¸‹æ–‡
â”‚   â”‚   â”œâ”€â”€ hooks/             # è‡ªå®šä¹‰Hooks
â”‚   â”‚   â”œâ”€â”€ services/          # APIæœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ api.ts         # APIæ¥å£å°è£…
â”‚   â”‚   â”œâ”€â”€ types/             # TypeScriptç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ App.tsx            # ä¸»åº”ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ package.json           # å‰ç«¯ä¾èµ–é…ç½®
â”‚   â””â”€â”€ tailwind.config.js     # Tailwind CSSé…ç½®
â”œâ”€â”€ backend/                    # åç«¯Node.jsåº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ User.ts        # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ Work.ts        # ä½œå“æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ MembershipTier.ts # ä¼šå‘˜ç­‰çº§æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ Payment.ts     # æ”¯ä»˜è®°å½•æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ Coupon.ts      # ä¼˜æƒ åˆ¸æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ SerialCode.ts  # åºåˆ—å·æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ Vote.ts        # æŠ•ç¥¨æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ Bootcamp.ts    # è®­ç»ƒè¥æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ routes/            # APIè·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts        # è®¤è¯è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ users.ts       # ç”¨æˆ·ç®¡ç†è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ works.ts       # ä½œå“ç®¡ç†è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ membership.ts  # ä¼šå‘˜ä½“ç³»è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ admin.ts       # ç®¡ç†å‘˜è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ middleware/        # ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts        # è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ membership.ts  # ä¼šå‘˜æƒé™ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ validation.ts  # æ•°æ®éªŒè¯ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ controllers/       # æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ config/            # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ database.ts    # æ•°æ®åº“é…ç½®
â”‚   â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ jwt.ts         # JWTå·¥å…·
â”‚   â”‚   â”‚   â””â”€â”€ upload.ts      # æ–‡ä»¶ä¸Šä¼ å·¥å…·
â”‚   â”‚   â”œâ”€â”€ types/             # TypeScriptç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ scripts/           # è„šæœ¬æ–‡ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ init-db.ts     # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ app.ts             # Expressåº”ç”¨é…ç½®
â”‚   â”‚   â”œâ”€â”€ server.ts          # æœåŠ¡å™¨å¯åŠ¨æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ index.ts           # ä¸»å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ uploads/               # æ–‡ä»¶ä¸Šä¼ ç›®å½•
â”‚   â”œâ”€â”€ package.json           # åç«¯ä¾èµ–é…ç½®
â”‚   â””â”€â”€ .env.example           # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ docs/                      # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ DEVELOPMENT.md         # å¼€å‘æ–‡æ¡£
â”‚   â”œâ”€â”€ API.md                 # APIæ–‡æ¡£
â”‚   â””â”€â”€ DEPLOYMENT.md          # éƒ¨ç½²æ–‡æ¡£
â”œâ”€â”€ package.json               # æ ¹ç›®å½•å·¥ä½œç©ºé—´é…ç½®
â”œâ”€â”€ README.md                  # é¡¹ç›®è¯´æ˜
â””â”€â”€ .gitignore                 # Gitå¿½ç•¥æ–‡ä»¶
```

## æ•°æ®åº“è®¾è®¡

### ç”¨æˆ·æ¨¡å‹ (User)
```typescript
interface User {
  _id: ObjectId;
  username: string;           // ç”¨æˆ·å
  email: string;              // é‚®ç®±
  password: string;           // åŠ å¯†å¯†ç 
  role: 'admin' | 'coach' | 'student' | 'volunteer'; // è§’è‰²
  avatar?: string;            // å¤´åƒURL
  bio?: string;               // ä¸ªäººç®€ä»‹
  membershipTier: ObjectId;   // ä¼šå‘˜ç­‰çº§ID
  membershipExpiry?: Date;    // ä¼šå‘˜åˆ°æœŸæ—¶é—´
  totalSpent: number;         // æ€»æ¶ˆè´¹é‡‘é¢
  availableCoupons: ObjectId[]; // å¯ç”¨ä¼˜æƒ åˆ¸
  usedCoupons: ObjectId[];    // å·²ä½¿ç”¨ä¼˜æƒ åˆ¸
  paymentHistory: ObjectId[]; // æ”¯ä»˜å†å²
  createdAt: Date;
  updatedAt: Date;
}
```

### ä½œå“æ¨¡å‹ (Work)
```typescript
interface Work {
  _id: ObjectId;
  title: string;              // ä½œå“æ ‡é¢˜
  description: string;        // ä½œå“æè¿°
  author: ObjectId;           // ä½œè€…ID
  type: 'html' | 'link';      // ä½œå“ç±»å‹
  content: string;            // HTMLå†…å®¹æˆ–é“¾æ¥URL
  coverImage: string;         // å°é¢å›¾ç‰‡URL
  bootcamp?: ObjectId;        // æ‰€å±è®­ç»ƒè¥
  tags: string[];             // æ ‡ç­¾
  isPublic: boolean;          // æ˜¯å¦å…¬å¼€
  isPinned: boolean;          // æ˜¯å¦ç½®é¡¶
  viewCount: number;          // æµè§ˆæ¬¡æ•°
  voteCount: number;          // æŠ•ç¥¨æ•°
  
  // åˆ†å±‚å†…å®¹ - æ ¹æ®ä¼šå‘˜ç­‰çº§æ˜¾ç¤ºä¸åŒå†…å®¹
  contentLayers: {
    preview: string;          // é¢„è§ˆå†…å®¹ï¼ˆæ‰€æœ‰ç”¨æˆ·å¯è§ï¼‰
    basic: string;            // åŸºç¡€å†…å®¹ï¼ˆå­¦å‘˜åŠä»¥ä¸Šï¼‰
    advanced: string;         // é«˜çº§å†…å®¹ï¼ˆä¼šå‘˜åŠä»¥ä¸Šï¼‰
    premium: string;          // é«˜ç«¯å†…å®¹ï¼ˆé«˜çº§ä¼šå‘˜åŠä»¥ä¸Šï¼‰
    source: string;           // æºç å†…å®¹ï¼ˆå…±åˆ›åŠä»¥ä¸Šï¼‰
  };
  
  requiredMembershipLevel: number; // æ‰€éœ€æœ€ä½ä¼šå‘˜ç­‰çº§
  createdAt: Date;
  updatedAt: Date;
}
```

### ä¼šå‘˜ç­‰çº§æ¨¡å‹ (MembershipTier)
```typescript
interface MembershipTier {
  _id: ObjectId;
  name: string;               // ç­‰çº§åç§°
  level: number;              // ç­‰çº§æ•°å€¼ï¼ˆ1-5ï¼‰
  priceRange: {
    min: number;              // æœ€ä½ä»·æ ¼
    max: number;              // æœ€é«˜ä»·æ ¼
  };
  color: string;              // ç­‰çº§é¢œè‰²
  icon: string;               // ç­‰çº§å›¾æ ‡
  description: string;        // ç­‰çº§æè¿°
  benefits: string[];         // æƒç›Šåˆ—è¡¨
  permissions: {
    canViewBasic: boolean;    // å¯æŸ¥çœ‹åŸºç¡€å†…å®¹
    canViewAdvanced: boolean; // å¯æŸ¥çœ‹é«˜çº§å†…å®¹
    canViewPremium: boolean;  // å¯æŸ¥çœ‹é«˜ç«¯å†…å®¹
    canViewSource: boolean;   // å¯æŸ¥çœ‹æºç 
    canUploadWorks: boolean;  // å¯ä¸Šä¼ ä½œå“
    canVote: boolean;         // å¯æŠ•ç¥¨
    maxUploadsPerDay: number; // æ¯æ—¥æœ€å¤§ä¸Šä¼ æ•°
  };
  isActive: boolean;          // æ˜¯å¦å¯ç”¨
  createdAt: Date;
  updatedAt: Date;
}
```

### æ”¯ä»˜è®°å½•æ¨¡å‹ (Payment)
```typescript
interface Payment {
  _id: ObjectId;
  user: ObjectId;             // ç”¨æˆ·ID
  amount: number;             // æ”¯ä»˜é‡‘é¢
  originalAmount: number;     // åŸå§‹é‡‘é¢
  discount: number;           // æŠ˜æ‰£é‡‘é¢
  paymentMethod: 'coupon' | 'serial'; // æ”¯ä»˜æ–¹å¼
  couponUsed?: ObjectId;      // ä½¿ç”¨çš„ä¼˜æƒ åˆ¸
  serialCodeUsed?: string;    // ä½¿ç”¨çš„åºåˆ—å·
  membershipTier: ObjectId;   // è´­ä¹°çš„ä¼šå‘˜ç­‰çº§
  status: 'pending' | 'completed' | 'failed'; // æ”¯ä»˜çŠ¶æ€
  transactionId?: string;     // äº¤æ˜“ID
  createdAt: Date;
  updatedAt: Date;
}
```

### ä¼˜æƒ åˆ¸æ¨¡å‹ (Coupon)
```typescript
interface Coupon {
  _id: ObjectId;
  code: string;               // ä¼˜æƒ åˆ¸ä»£ç 
  name: string;               // ä¼˜æƒ åˆ¸åç§°
  description: string;        // æè¿°
  discountType: 'percentage' | 'fixed'; // æŠ˜æ‰£ç±»å‹
  discountValue: number;      // æŠ˜æ‰£å€¼
  minPurchaseAmount: number;  // æœ€ä½æ¶ˆè´¹é‡‘é¢
  maxDiscountAmount?: number; // æœ€å¤§æŠ˜æ‰£é‡‘é¢
  usageLimit: number;         // ä½¿ç”¨æ¬¡æ•°é™åˆ¶
  usedCount: number;          // å·²ä½¿ç”¨æ¬¡æ•°
  validFrom: Date;            // æœ‰æ•ˆæœŸå¼€å§‹
  validTo: Date;              // æœ‰æ•ˆæœŸç»“æŸ
  isActive: boolean;          // æ˜¯å¦å¯ç”¨
  applicableTiers: ObjectId[]; // é€‚ç”¨çš„ä¼šå‘˜ç­‰çº§
  createdBy: ObjectId;        // åˆ›å»ºè€…
  createdAt: Date;
  updatedAt: Date;
}
```

### åºåˆ—å·æ¨¡å‹ (SerialCode)
```typescript
interface SerialCode {
  _id: ObjectId;
  code: string;               // åºåˆ—å·
  membershipTier: ObjectId;   // å¯¹åº”ä¼šå‘˜ç­‰çº§
  isUsed: boolean;            // æ˜¯å¦å·²ä½¿ç”¨
  usedBy?: ObjectId;          // ä½¿ç”¨è€…ID
  usedAt?: Date;              // ä½¿ç”¨æ—¶é—´
  validFrom: Date;            // æœ‰æ•ˆæœŸå¼€å§‹
  validTo: Date;              // æœ‰æ•ˆæœŸç»“æŸ
  batchId?: string;           // æ‰¹æ¬¡ID
  createdBy: ObjectId;        // åˆ›å»ºè€…
  createdAt: Date;
  updatedAt: Date;
}
```

## APIæ¥å£æ–‡æ¡£

### è®¤è¯æ¥å£

#### POST /api/auth/register
æ³¨å†Œæ–°ç”¨æˆ·
```typescript
// è¯·æ±‚ä½“
{
  username: string;
  email: string;
  password: string;
  role?: 'student' | 'volunteer';
}

// å“åº”
{
  success: boolean;
  message: string;
  data?: {
    user: User;
    token: string;
  };
}
```

#### POST /api/auth/login
ç”¨æˆ·ç™»å½•
```typescript
// è¯·æ±‚ä½“
{
  email: string;
  password: string;
}

// å“åº”
{
  success: boolean;
  message: string;
  data?: {
    user: User;
    token: string;
  };
}
```

### ä½œå“ç®¡ç†æ¥å£

#### GET /api/works
è·å–ä½œå“åˆ—è¡¨
```typescript
// æŸ¥è¯¢å‚æ•°
{
  page?: number;
  limit?: number;
  bootcamp?: string;
  sortBy?: 'votes' | 'views' | 'date';
  order?: 'asc' | 'desc';
}

// å“åº”
{
  success: boolean;
  data: {
    works: Work[];
    total: number;
    page: number;
    totalPages: number;
  };
}
```

#### POST /api/works
åˆ›å»ºæ–°ä½œå“
```typescript
// è¯·æ±‚ä½“ (multipart/form-data)
{
  title: string;
  description: string;
  type: 'html' | 'link';
  content: string;
  coverImage: File;
  bootcamp?: string;
  tags: string[];
  contentLayers: {
    preview: string;
    basic: string;
    advanced: string;
    premium: string;
    source: string;
  };
  requiredMembershipLevel: number;
}

// å“åº”
{
  success: boolean;
  message: string;
  data?: Work;
}
```

### ä¼šå‘˜ä½“ç³»æ¥å£

#### GET /api/membership/tiers
è·å–ä¼šå‘˜ç­‰çº§åˆ—è¡¨
```typescript
// å“åº”
{
  success: boolean;
  data: MembershipTier[];
}
```

#### POST /api/membership/upgrade
ä¼šå‘˜å‡çº§
```typescript
// è¯·æ±‚ä½“
{
  tierLevel: number;
  paymentMethod: 'coupon' | 'serial';
  couponCode?: string;
  serialCode?: string;
}

// å“åº”
{
  success: boolean;
  message: string;
  data?: {
    payment: Payment;
    newMembership: MembershipTier;
  };
}
```

### ç®¡ç†å‘˜æ¥å£

#### GET /api/admin/users
è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆç®¡ç†å‘˜ï¼‰
```typescript
// æŸ¥è¯¢å‚æ•°
{
  page?: number;
  limit?: number;
  role?: string;
  membershipLevel?: number;
}

// å“åº”
{
  success: boolean;
  data: {
    users: User[];
    total: number;
    page: number;
    totalPages: number;
  };
}
```

#### POST /api/admin/coupons
åˆ›å»ºä¼˜æƒ åˆ¸ï¼ˆç®¡ç†å‘˜ï¼‰
```typescript
// è¯·æ±‚ä½“
{
  code: string;
  name: string;
  description: string;
  discountType: 'percentage' | 'fixed';
  discountValue: number;
  minPurchaseAmount: number;
  maxDiscountAmount?: number;
  usageLimit: number;
  validFrom: string;
  validTo: string;
  applicableTiers: string[];
}

// å“åº”
{
  success: boolean;
  message: string;
  data?: Coupon;
}
```

## å‰ç«¯ç»„ä»¶è¯´æ˜

### æ ¸å¿ƒç»„ä»¶

#### Layout.tsx
é¡µé¢å¸ƒå±€ç»„ä»¶ï¼ŒåŒ…å«ä¾§è¾¹æ å’Œä¸»å†…å®¹åŒºåŸŸ
```typescript
interface LayoutProps {
  children: React.ReactNode;
}

// åŠŸèƒ½ç‰¹æ€§
- å“åº”å¼ä¾§è¾¹æ 
- ç”¨æˆ·è®¤è¯çŠ¶æ€æ˜¾ç¤º
- å¯¼èˆªèœå•ç®¡ç†
- ç§»åŠ¨ç«¯é€‚é…
```

#### MembershipBadge.tsx
ä¼šå‘˜ç­‰çº§æ ‡è¯†ç»„ä»¶
```typescript
interface MembershipBadgeProps {
  tier: MembershipTier;
  size?: 'sm' | 'md' | 'lg';
  showLevel?: boolean;
}

// åŠŸèƒ½ç‰¹æ€§
- åŠ¨æ€é¢œè‰²æ˜¾ç¤º
- å¤šç§å°ºå¯¸æ”¯æŒ
- ç­‰çº§æ•°å€¼æ˜¾ç¤º
- æ‚¬åœæç¤ºä¿¡æ¯
```

#### UpgradePrompt.tsx
å‡çº§æç¤ºç»„ä»¶
```typescript
interface UpgradePromptProps {
  requiredLevel: number;
  currentLevel: number;
  feature: string;
}

// åŠŸèƒ½ç‰¹æ€§
- æ™ºèƒ½æƒé™æ£€æµ‹
- å‹å¥½çš„å‡çº§å¼•å¯¼
- é¿å…æ˜¾ç¤ºæ— æƒé™å†…å®¹
- ä¸€é”®è·³è½¬å‡çº§é¡µé¢
```

#### WorkCard.tsx
ä½œå“å¡ç‰‡ç»„ä»¶
```typescript
interface WorkCardProps {
  work: Work;
  userMembershipLevel: number;
  onVote?: (workId: string) => void;
}

// åŠŸèƒ½ç‰¹æ€§
- åˆ†å±‚å†…å®¹å±•ç¤º
- æƒé™æ™ºèƒ½è¿‡æ»¤
- æŠ•ç¥¨åŠŸèƒ½é›†æˆ
- å“åº”å¼è®¾è®¡
```

### é¡µé¢ç»„ä»¶

#### WorksPage.tsx
ä½œå“å±•ç¤ºé¡µé¢
- ä½œå“åˆ—è¡¨å±•ç¤º
- å¤šç»´åº¦æ’åº
- åˆ†é¡µåŠ è½½
- è®­ç»ƒè¥ç­›é€‰
- æƒé™æ§åˆ¶å±•ç¤º

#### MembershipPage.tsx
ä¼šå‘˜ä¸­å¿ƒé¡µé¢
- å½“å‰ç­‰çº§å±•ç¤º
- å‡çº§é€‰é¡¹
- æ”¯ä»˜å†å²
- ä¼˜æƒ åˆ¸ç®¡ç†

#### AdminPage.tsx
ç®¡ç†åå°é¡µé¢
- ç”¨æˆ·ç®¡ç†
- ä½œå“å®¡æ ¸
- æ•°æ®ç»Ÿè®¡
- ç³»ç»Ÿé…ç½®

## ä¼šå‘˜ä½“ç³»è®¾è®¡

### ç­‰çº§ä½“ç³»
```
1. å­¦å‘˜ (Student) - 9.9-99å…ƒ
   - æŸ¥çœ‹åŸºç¡€å†…å®¹
   - ä¸Šä¼ ä½œå“
   - å‚ä¸æŠ•ç¥¨

2. ä¼šå‘˜ (Member) - 100-999å…ƒ
   - å­¦å‘˜æ‰€æœ‰æƒé™
   - æŸ¥çœ‹é«˜çº§å†…å®¹
   - ä¼˜å…ˆå±•ç¤º

3. é«˜çº§ä¼šå‘˜ (Advanced Member) - 1000-4999å…ƒ
   - ä¼šå‘˜æ‰€æœ‰æƒé™
   - æŸ¥çœ‹é«˜ç«¯å†…å®¹
   - ä¸“å±æ ‡è¯†

4. å…±åˆ› (Co-creator) - 5000-14999å…ƒ
   - é«˜çº§ä¼šå‘˜æ‰€æœ‰æƒé™
   - æŸ¥çœ‹æºç 
   - å‚ä¸å†…å®¹åˆ›ä½œ

5. è®²å¸ˆ (Instructor) - 15000å…ƒä»¥ä¸Š
   - å…±åˆ›æ‰€æœ‰æƒé™
   - å‘å¸ƒè¯¾ç¨‹
   - ç®¡ç†å­¦å‘˜
```

### æƒé™çŸ©é˜µ
| åŠŸèƒ½ | æ¸¸å®¢ | å­¦å‘˜ | ä¼šå‘˜ | é«˜çº§ä¼šå‘˜ | å…±åˆ› | è®²å¸ˆ |
|------|------|------|------|----------|------|------|
| æµè§ˆé¢„è§ˆå†…å®¹ | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… |
| æŸ¥çœ‹åŸºç¡€å†…å®¹ | âŒ | âœ… | âœ… | âœ… | âœ… | âœ… |
| æŸ¥çœ‹é«˜çº§å†…å®¹ | âŒ | âŒ | âœ… | âœ… | âœ… | âœ… |
| æŸ¥çœ‹é«˜ç«¯å†…å®¹ | âŒ | âŒ | âŒ | âœ… | âœ… | âœ… |
| æŸ¥çœ‹æºç  | âŒ | âŒ | âŒ | âŒ | âœ… | âœ… |
| ä¸Šä¼ ä½œå“ | âŒ | âœ… | âœ… | âœ… | âœ… | âœ… |
| å‚ä¸æŠ•ç¥¨ | âŒ | âœ… | âœ… | âœ… | âœ… | âœ… |
| æ¯æ—¥ä¸Šä¼ é™åˆ¶ | 0 | 3 | 5 | 10 | 20 | æ— é™åˆ¶ |

### å‡çº§æœºåˆ¶
1. **ä¼˜æƒ åˆ¸å‡çº§**: ä½¿ç”¨ä¼˜æƒ åˆ¸ä»£ç äº«å—æŠ˜æ‰£
2. **åºåˆ—å·ç›´è´­**: ä½¿ç”¨åºåˆ—å·ç›´æ¥æ¿€æ´»ç­‰çº§
3. **ä»·æ ¼åŒºé—´**: æ¯ä¸ªç­‰çº§å¯¹åº”ä¸åŒä»·æ ¼åŒºé—´ï¼Œçµæ´»å®šä»·

## æƒé™æ§åˆ¶æœºåˆ¶

### åç«¯æƒé™æ§åˆ¶
```typescript
// ä¼šå‘˜æƒé™ä¸­é—´ä»¶
export const requireMembership = (minLevel: number) => {
  return async (req: Request, res: Response, next: NextFunction) => {
    const user = req.user;
    const userTier = await MembershipTier.findById(user.membershipTier);
    
    if (!userTier || userTier.level < minLevel) {
      return res.status(403).json({
        success: false,
        message: 'æƒé™ä¸è¶³ï¼Œéœ€è¦æ›´é«˜ç­‰çº§çš„ä¼šå‘˜'
      });
    }
    
    next();
  };
};

// ä½¿ç”¨ç¤ºä¾‹
router.get('/premium-content', 
  auth, 
  requireMembership(3), // éœ€è¦é«˜çº§ä¼šå‘˜
  getPremiumContent
);
```

### å‰ç«¯æƒé™æ§åˆ¶
```typescript
// æƒé™æ£€æŸ¥Hook
const usePermission = () => {
  const { user } = useAuth();
  
  const hasPermission = (requiredLevel: number) => {
    return user?.membershipTier?.level >= requiredLevel;
  };
  
  const canViewContent = (contentLevel: string) => {
    const levelMap = {
      'preview': 0,
      'basic': 1,
      'advanced': 2,
      'premium': 3,
      'source': 4
    };
    
    return hasPermission(levelMap[contentLevel]);
  };
  
  return { hasPermission, canViewContent };
};

// ç»„ä»¶ä¸­ä½¿ç”¨
const WorkDetail = ({ work }) => {
  const { canViewContent } = usePermission();
  
  return (
    <div>
      {/* é¢„è§ˆå†…å®¹ - æ‰€æœ‰ç”¨æˆ·å¯è§ */}
      <div>{work.contentLayers.preview}</div>
      
      {/* åŸºç¡€å†…å®¹ - å­¦å‘˜åŠä»¥ä¸Š */}
      {canViewContent('basic') ? (
        <div>{work.contentLayers.basic}</div>
      ) : (
        <UpgradePrompt requiredLevel={1} feature="åŸºç¡€å†…å®¹" />
      )}
      
      {/* é«˜çº§å†…å®¹ - ä¼šå‘˜åŠä»¥ä¸Š */}
      {canViewContent('advanced') && (
        <div>{work.contentLayers.advanced}</div>
      )}
    </div>
  );
};
```

## å¼€å‘è§„èŒƒ

### ä»£ç è§„èŒƒ
1. **TypeScript**: å…¨é¡¹ç›®ä½¿ç”¨TypeScriptï¼Œä¸¥æ ¼ç±»å‹æ£€æŸ¥
2. **ESLint**: ä½¿ç”¨ESLintè¿›è¡Œä»£ç è´¨é‡æ£€æŸ¥
3. **Prettier**: ç»Ÿä¸€ä»£ç æ ¼å¼åŒ–
4. **å‘½åè§„èŒƒ**: 
   - ç»„ä»¶ä½¿ç”¨PascalCase
   - å‡½æ•°å’Œå˜é‡ä½¿ç”¨camelCase
   - å¸¸é‡ä½¿ç”¨UPPER_SNAKE_CASE
   - æ–‡ä»¶åä½¿ç”¨kebab-caseæˆ–PascalCase

### Gitå·¥ä½œæµ
1. **åˆ†æ”¯ç­–ç•¥**: 
   - `main`: ä¸»åˆ†æ”¯ï¼Œç”Ÿäº§ç¯å¢ƒä»£ç 
   - `develop`: å¼€å‘åˆ†æ”¯
   - `feature/*`: åŠŸèƒ½åˆ†æ”¯
   - `hotfix/*`: çƒ­ä¿®å¤åˆ†æ”¯

2. **æäº¤è§„èŒƒ**:
```
feat: æ–°åŠŸèƒ½
fix: ä¿®å¤bug
docs: æ–‡æ¡£æ›´æ–°
style: ä»£ç æ ¼å¼è°ƒæ•´
refactor: ä»£ç é‡æ„
test: æµ‹è¯•ç›¸å…³
chore: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨
```

### æµ‹è¯•è§„èŒƒ
1. **å•å…ƒæµ‹è¯•**: ä½¿ç”¨Jestè¿›è¡Œå•å…ƒæµ‹è¯•
2. **é›†æˆæµ‹è¯•**: APIæ¥å£é›†æˆæµ‹è¯•
3. **E2Eæµ‹è¯•**: å…³é”®ç”¨æˆ·æµç¨‹ç«¯åˆ°ç«¯æµ‹è¯•
4. **æµ‹è¯•è¦†ç›–ç‡**: ä¿æŒ80%ä»¥ä¸Šçš„æµ‹è¯•è¦†ç›–ç‡

## éƒ¨ç½²æŒ‡å—

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

#### 1. æœåŠ¡å™¨è¦æ±‚
- Ubuntu 20.04 LTS æˆ– CentOS 8
- Node.js 16+ 
- MongoDB 4.4+
- Nginx (åå‘ä»£ç†)
- SSLè¯ä¹¦ (HTTPS)

#### 2. éƒ¨ç½²æ­¥éª¤
```bash
# 1. å…‹éš†ä»£ç 
git clone https://github.com/xiaohuAI319/xiaohu-codebuddy-learning-site.git
cd xiaohu-codebuddy-learning-site

# 2. å®‰è£…ä¾èµ–
npm install
cd frontend && npm install
cd ../backend && npm install

# 3. æ„å»ºå‰ç«¯
cd frontend
npm run build

# 4. é…ç½®ç¯å¢ƒå˜é‡
cd ../backend
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œè®¾ç½®ç”Ÿäº§ç¯å¢ƒé…ç½®

# 5. åˆå§‹åŒ–æ•°æ®åº“
npm run init-db

# 6. å¯åŠ¨æœåŠ¡
npm run start
```

#### 3. Nginxé…ç½®
```nginx
server {
    listen 80;
    server_name your-domain.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name your-domain.com;
    
    ssl_certificate /path/to/certificate.crt;
    ssl_certificate_key /path/to/private.key;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /path/to/frontend/build;
        try_files $uri $uri/ /index.html;
    }
    
    # APIä»£ç†
    location /api {
        proxy_pass http://localhost:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
    
    # æ–‡ä»¶ä¸Šä¼ 
    location /uploads {
        alias /path/to/backend/uploads;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

#### 4. PM2è¿›ç¨‹ç®¡ç†
```bash
# å®‰è£…PM2
npm install -g pm2

# å¯åŠ¨åº”ç”¨
pm2 start backend/dist/server.js --name "xiaohu-codebuddy"

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
pm2 save
```

### Dockeréƒ¨ç½²

#### Dockerfile
```dockerfile
# å‰ç«¯æ„å»º
FROM node:16-alpine AS frontend-build
WORKDIR /app/frontend
COPY frontend/package*.json ./
RUN npm ci --only=production
COPY frontend/ ./
RUN npm run build

# åç«¯æ„å»º
FROM node:16-alpine AS backend-build
WORKDIR /app/backend
COPY backend/package*.json ./
RUN npm ci --only=production
COPY backend/ ./
RUN npm run build

# ç”Ÿäº§é•œåƒ
FROM node:16-alpine
WORKDIR /app

# å¤åˆ¶åç«¯ä»£ç 
COPY --from=backend-build /app/backend/dist ./dist
COPY --from=backend-build /app/backend/node_modules ./node_modules
COPY --from=backend-build /app/backend/package.json ./

# å¤åˆ¶å‰ç«¯æ„å»ºæ–‡ä»¶
COPY --from=frontend-build /app/frontend/build ./public

# åˆ›å»ºä¸Šä¼ ç›®å½•
RUN mkdir -p uploads

EXPOSE 5000

CMD ["node", "dist/server.js"]
```

#### docker-compose.yml
```yaml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "5000:5000"
    environment:
      - NODE_ENV=production
      - MONGODB_URI=mongodb://mongo:27017/xiaohu-codebuddy
      - JWT_SECRET=your-production-jwt-secret
    depends_on:
      - mongo
    volumes:
      - ./uploads:/app/uploads

  mongo:
    image: mongo:4.4
    ports:
      - "27017:27017"
    volumes:
      - mongo_data:/data/db
    environment:
      - MONGO_INITDB_DATABASE=xiaohu-codebuddy

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - app

volumes:
  mongo_data:
```

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•æ·»åŠ æ–°çš„ä¼šå‘˜ç­‰çº§ï¼Ÿ
A: åœ¨ç®¡ç†åå°çš„"ä¼šå‘˜ä½“ç³»ç®¡ç†"ä¸­å¯ä»¥åŠ¨æ€æ·»åŠ æ–°ç­‰çº§ï¼Œè®¾ç½®ç­‰çº§åç§°ã€ä»·æ ¼åŒºé—´ã€æƒé™ç­‰ã€‚

### Q2: å¦‚ä½•è‡ªå®šä¹‰å†…å®¹åˆ†å±‚ï¼Ÿ
A: åœ¨ä¸Šä¼ ä½œå“æ—¶ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªå†…å®¹å±‚çº§è®¾ç½®ä¸åŒçš„å†…å®¹ï¼Œç³»ç»Ÿä¼šæ ¹æ®ç”¨æˆ·ä¼šå‘˜ç­‰çº§è‡ªåŠ¨è¿‡æ»¤æ˜¾ç¤ºã€‚

### Q3: å¦‚ä½•æ‰¹é‡ç”Ÿæˆåºåˆ—å·ï¼Ÿ
A: åœ¨ç®¡ç†åå°çš„"åºåˆ—å·ç®¡ç†"ä¸­ï¼Œå¯ä»¥æ‰¹é‡ç”ŸæˆæŒ‡å®šæ•°é‡çš„åºåˆ—å·ï¼Œæ”¯æŒè®¾ç½®æœ‰æ•ˆæœŸå’Œå¯¹åº”ç­‰çº§ã€‚

### Q4: å¦‚ä½•é…ç½®ä¼˜æƒ åˆ¸ï¼Ÿ
A: åœ¨ç®¡ç†åå°åˆ›å»ºä¼˜æƒ åˆ¸æ—¶ï¼Œå¯ä»¥è®¾ç½®æŠ˜æ‰£ç±»å‹ï¼ˆç™¾åˆ†æ¯”/å›ºå®šé‡‘é¢ï¼‰ã€ä½¿ç”¨é™åˆ¶ã€æœ‰æ•ˆæœŸç­‰ã€‚

### Q5: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ
A: ä½¿ç”¨MongoDBçš„mongodumpå·¥å…·å®šæœŸå¤‡ä»½æ•°æ®åº“ï¼Œå»ºè®®è®¾ç½®è‡ªåŠ¨å¤‡ä»½è„šæœ¬ã€‚

### Q6: å¦‚ä½•ç›‘æ§ç³»ç»Ÿæ€§èƒ½ï¼Ÿ
A: å¯ä»¥é›†æˆç›‘æ§å·¥å…·å¦‚New Relicã€DataDogæˆ–ä½¿ç”¨å¼€æºæ–¹æ¡ˆå¦‚Prometheus + Grafanaã€‚

### Q7: å¦‚ä½•æ‰©å±•æ”¯ä»˜æ–¹å¼ï¼Ÿ
A: åœ¨Paymentæ¨¡å‹ä¸­æ·»åŠ æ–°çš„æ”¯ä»˜æ–¹å¼ç±»å‹ï¼Œå¹¶åœ¨ç›¸åº”çš„APIä¸­å®ç°æ”¯ä»˜é€»è¾‘ã€‚

---

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- GitHub Issues: https://github.com/xiaohuAI319/xiaohu-codebuddy-learning-site/issues
- é‚®ç®±: support@xiaohu.com
- å¾®ä¿¡ç¾¤: å°è™CodeBuddyå­¦ä¹ ç¾¤

---

*æœ€åæ›´æ–°: 2024å¹´9æœˆ25æ—¥*